---
title: "DataCamp Assignment"
output: html_notebook
---

This is an [DataCampt](http://www.datacamp.com) Assignment Notebook for EdX Inferential and Modelling course Section 7 offered by Harvaard University. 

```{r message=FALSE, warning=FALSE, paged.print=FALSE}
# Load the libraries and poll data
library(dplyr)
library(dslabs)
library(tidyverse)
data(polls_us_election_2016)

# Loading errors

# Create a table called `polls` that filters by  state, date, and reports the spread
polls <- polls_us_election_2016 %>% 
  filter(state != "U.S." & enddate >= "2016-10-31") %>% 
  mutate(spread = rawpoll_clinton/100 - rawpoll_trump/100)

# Create an object called `cis` that has the columns indicated in the instructions
cis <- polls %>%
    mutate(X_hat = (spread + 1) / 2,
           se = 2 * sqrt(X_hat * (1 - X_hat) / samplesize),
           lower = spread - qnorm(0.975)*se,
           upper = spread + qnorm(0.975)*se) %>%
    select(state, startdate, enddate, pollster, grade, spread, lower, upper)

# Create an object called `errors` that calculates the difference between the predicted and actual spread and indicates if the correct winner was predicted
add <- results_us_election_2016 %>% mutate(actual_spread = clinton/100 - trump/100) %>% select(state, actual_spread)
ci_data <- cis %>% mutate(state = as.character(state)) %>% left_join(add, by = "state")
errors <- ci_data %>% mutate(error = spread - actual_spread, hit = sign(spread) == sign(actual_spread))
```

## Exercise 1 - Comparing Proportions of Hits

In a previous exercise, we determined whether or not each poll predicted the correct winner for their state in the 2016 U.S. presidential election. Each poll was also assigned a grade by the poll aggregator. Now we're going to determine if polls rated A- made better predictions than polls rated C-.

In this exercise, filter the errors data for just polls with grades A- and C-. Calculate the proportion of times each grade of poll predicted the correct winner.

### Instructions

- Filter errors for grades A- and C-.
- Group the data by grade and hit.
- Summarize the number of hits for each grade.
- Generate a two-by-two table containing the number of hits and misses for each grade. Try using the spread function to generate this table.

```{r}
# The 'errors' data have already been loaded. Examine them using the `head` function.
head(errors)

# Generate an object called 'totals' that contains the numbers of good and bad predictions for polls rated A- and C-
totals <- errors %>%
    filter(grade %in% c('A-', 'C-')) %>%
    group_by(grade, hit) %>%
    summarise(no_of_hits = n())

totals <- spread(totals, hit, no_of_hits)

# Print the proportion of hits for grade A- polls to the console
as.integer(totals[totals$grade == 'A-', 3]) / sum(totals[totals$grade == 'A-', 2:3])

# Print the proportion of hits for grade C- polls to the console
as.integer(totals[totals$grade == 'C-', 3]) / sum(totals[totals$grade == 'C-', 2:3])
```

## Exercise 2 - Chi-squared Test

We found that the A- polls predicted the correct winner about 80% of the time in their states and C- polls predicted the correct winner about 86% of the time.

Use a chi-squared test to determine if these proportions are different.

### Instructions

- Use the chisq.test function to perform the chi-squared test. Save the results to an object called chisq_test.
- Print the p-value of the test to the console.

```{r}
# The 'totals' data have already been loaded. Examine them using the `head` function.
head(totals)

# Perform a chi-squared test on the hit data. Save the results as an object called 'chisq_test'.
chisq_test <- chisq.test(totals[, 2:3])

# Print the p-value of the chi-squared test to the console
chisq_test$p.value
```
## Exercise 3 - Odds Ratio Calculation

It doesn't look like the grade A- polls performed significantly differently than the grade C- polls in their states.

Calculate the odds ratio to determine the magnitude of the difference in performance between these two grades of polls.

### Instructions

- Calculate the odds that a grade C- poll predicts the correct winner. Save this result to a variable called odds_C.
- Calculate the odds that a grade A- poll predicts the correct winner. Save this result to a variable called odds_A.
- Calculate the odds ratio that tells us how many times larger the odds of a grade A- poll is at predicting the winner than a grade C- poll.

```{r}
# The 'totals' data have already been loaded. Examine them using the `head` function.
head(totals)

# Generate a variable called `odds_C` that contains the odds of getting the prediction right for grade C- polls
odds_C <- as.integer(totals[1, 3]) / sum(totals[1, 2:3]) / as.integer(totals[1, 2]) / sum(totals[1, 2:3])

# Generate a variable called `odds_A` that contains the odds of getting the prediction right for grade A- polls
odds_A <- as.integer(totals[2, 3]) / sum(totals[2, 2:3]) / as.integer(totals[2, 2]) / sum(totals[2, 2:3])

# Calculate the odds ratio to determine how many times larger the odds ratio is for grade A- polls than grade C- polls
odds_A / odds_C
```

